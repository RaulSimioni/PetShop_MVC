{% extends "base.html" %}

{% block title %}Novo Pet - PetShop ERP{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <span class="material-symbols-outlined me-2" style="color: var(--primary-color); font-size: 2rem; vertical-align: middle;">pets</span>
        Cadastrar Novo Pet
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('pet_views.listar_pets') }}" class="btn btn-outline-secondary">
            <span class="material-symbols-outlined me-1">arrow_back</span> Voltar
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <span class="material-symbols-outlined me-2">info</span>
                    Dados do Pet
                </h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nome" class="form-label">Nome *</label>
                            <input type="text" class="form-control" id="nome" name="nome" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="cliente_id" class="form-label">Dono *</label>
                            <select class="form-select" id="cliente_id" name="cliente_id" required>
                                <option value="">Selecione o dono</option>
                                {% for cliente in clientes %}
                                <option value="{{ cliente.id }}" {% if cliente_selecionado == cliente.id %}selected{% endif %}>
                                    {{ cliente.nome }} ({{ cliente.cpf }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="especie" class="form-label">Espécie *</label>
                            <select class="form-select" id="especie" name="especie" required>
                                <option value="">Selecione a espécie</option>
                                {% for esp in especies %}
                                <option value="{{ esp }}">{{ esp }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="sexo" class="form-label">Sexo</label>
                            <select class="form-select" id="sexo" name="sexo">
                                <option value="">Selecione o sexo</option>
                                {% for s in sexos %}
                                <option value="{{ s }}">{{ s }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="raca" class="form-label">Raça</label>
                            <input type="text" class="form-control" id="raca" name="raca" placeholder="Ex: Labrador, Siamês, etc.">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="cor" class="form-label">Cor</label>
                            <input type="text" class="form-control" id="cor" name="cor" placeholder="Ex: Preto, Branco, Caramelo">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="data_nascimento" class="form-label">Data de Nascimento</label>
                            <input type="date" class="form-control" id="data_nascimento" name="data_nascimento">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="peso" class="form-label">Peso (kg)</label>
                            <input type="number" step="0.1" min="0" class="form-control" id="peso" name="peso" placeholder="Ex: 5.2">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="observacoes" class="form-label">Observações</label>
                        <textarea class="form-control" id="observacoes" name="observacoes" rows="3" 
                                  placeholder="Informações adicionais sobre o pet (alergias, medicamentos, comportamento, etc.)"></textarea>
                    </div>

                    <div class="d-flex justify-content-end gap-2">
                        <a href="{{ url_for('pet_views.listar_pets') }}" class="btn btn-secondary">
                            <span class="material-symbols-outlined me-1">cancel</span> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <span class="material-symbols-outlined me-1">save</span> Cadastrar Pet
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <span class="material-symbols-outlined me-2">help</span>
                    Dicas de Cadastro
                </h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <span class="material-symbols-outlined text-primary me-2" style="font-size: 1.2rem;">info</span>
                        <small>Campos com * são obrigatórios</small>
                    </li>
                    <li class="mb-2">
                        <span class="material-symbols-outlined text-success me-2" style="font-size: 1.2rem;">pets</span>
                        <small>O nome deve ser único para cada dono</small>
                    </li>
                    <li class="mb-2">
                        <span class="material-symbols-outlined text-warning me-2" style="font-size: 1.2rem;">scale</span>
                        <small>O peso ajuda no cálculo de medicações</small>
                    </li>
                    <li class="mb-2">
                        <span class="material-symbols-outlined text-info me-2" style="font-size: 1.2rem;">note</span>
                        <small>Use observações para anotar informações importantes</small>
                    </li>
                </ul>
            </div>
        </div>

        {% if cliente_selecionado %}
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <span class="material-symbols-outlined me-2">person</span>
                    Dono Selecionado
                </h6>
            </div>
            <div class="card-body">
                {% for cliente in clientes %}
                    {% if cliente.id == cliente_selecionado %}
                    <p class="mb-1"><strong>{{ cliente.nome }}</strong></p>
                    <p class="text-muted small mb-1">CPF: {{ cliente.cpf }}</p>
                    <p class="text-muted small mb-0">Telefone: {{ cliente.telefone }}</p>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Validação de data de nascimento
    const dataNascimento = document.getElementById('data_nascimento');
    const hoje = new Date().toISOString().split('T')[0];
    dataNascimento.setAttribute('max', hoje);

    // Validação do formulário
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const nome = document.getElementById('nome').value.trim();
        const clienteId = document.getElementById('cliente_id').value;
        const especie = document.getElementById('especie').value;

        if (!nome) {
            e.preventDefault();
            alert('Nome é obrigatório');
            document.getElementById('nome').focus();
            return;
        }

        if (!clienteId) {
            e.preventDefault();
            alert('Selecione o dono do pet');
            document.getElementById('cliente_id').focus();
            return;
        }

        if (!especie) {
            e.preventDefault();
            alert('Selecione a espécie do pet');
            document.getElementById('especie').focus();
            return;
        }
    });

    // Limpar espaços em branco ao sair dos campos de texto
    const textInputs = document.querySelectorAll('input[type="text"], textarea');
    textInputs.forEach(input => {
        input.addEventListener('blur', function() {
            this.value = this.value.trim();
        });
    });
});
</script>
{% endblock %}